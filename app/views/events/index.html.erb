<%= render 'layouts/header' %>

<h1> Activities for <%= @practice.name %> </h1>

<div>

  <div id='openPopupForm'>
    <h3>Activities
      <a class='addButton' title="Add New Activity" rel="tooltip">
        <%= image_tag("plus-blue.png", size: "15x15") %>
      </a>
    </h3>
  </div>

  <div id='popupForm'>
    <%= form_for(@event) do |f| %>
      <% if @event.errors.any? %>
        <div id="error_explanation">
          <h2><%= pluralize(@event.errors.count, "error") %> prohibited this activity from being saved:</h2>

          <ul>
          <% @event.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
          </ul>
        </div>
      <% end %>

      <div id="closePopupForm">
        <a><%= image_tag("close.gif", alt: "Close") %></a>
      </div>
      <h3>New Activity</h3>
      <table class='space'>
        <tr>
          <td><%= f.label :practice_id, "Practice" %></td>
          <td><%= f.select :practice_id, options_for_select(Practice.order("name").map{ |p| [p.name, p.id] }), selected: params[:practice_id] %></td>
        </tr>
        <tr>
          <td><%= f.label :partner_id, "Assigned Recruiter" %></td>
          <td><%= f.select :partner_id, options_for_select(Partner.order("name").map{ |p| [p.name, p.id] }, selected: current_partner.id) %></td>
        </tr>
        <tr>
          <td><%= f.label :schedule_dt, "Date" %></td>
          <td><%= f.text_field :schedule_dt, class: 'datepicker' %> mm/dd/yyyy</td>
        </tr>
        <tr>
          <td><%= f.label :schedule_tm, "Time" %></td>
          <td><%= f.text_field :schedule_tm, type: "time" %> hh:mm MM</td>
        </tr>
        <tr>
          <td><%= f.label :contact_type, "Mode" %></td>
          <td><%= f.select :contact_type, Event::CONTACT_TYPE_VALS %></td>
        </tr>
        <tr>
          <td><%= f.label :description, "Notes" %></td>
          <td><%= f.text_area :description, rows: 5 %></td>
        </tr>
      </table>

      <div class="actions">
        <%= f.submit "Add Activity" %>
      </div>
    <% end %>
  </div>

  <% if @practice.events.any? %>
    <table class='typical enable-data-table'>
      <thead>
        <tr>
          <th>Date</th>
          <th>Time</th>
          <th>Assigned<br />Recruiter</th>
          <th>Mode</th>
          <th>Outcome</th>
          <th>Notes</th>
        </tr>
      </thead>
      <tbody>
        <% @practice.events.order("schedule_dt, schedule_tm").each do |e| %>
          <tr>
            <td><%= link_to e.schedule_dt.try(:strftime, "%Y-%m-%d"), edit_practice_event_path(@practice, e), title: "Edit Contact", rel: "tooltip" %></td>
            <td><%= e.schedule_tm.try(:strftime, "%l:%M %p") %></td>
            <td><%= e.partner.name %></td>
            <td><%= Event::CONTACT_TYPE_VALS.key(e.contact_type) %></td>
            <td><%= Event::OUTCOME_VALS.key(e.outcome) %></td>
            <td><%= truncate(e.description, length: 75) %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <br />
    <h4> No activities noted. </h4>
    <br />
  <% end %>
</div>

<div class='clearfix'></div>

<%= link_to "Back", :back %>