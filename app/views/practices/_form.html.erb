<%= form_for(@practice) do |f| %>
  <% if @practice.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@practice.errors.count, "error") %> prohibited this practice from being saved:</h2>

      <ul>
      <% @practice.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

<div id='nav-section'>
  <nav>
    <ul id='main-menu'>
      <li><%= link_to "General", "#general" %></li>
      <li><%= link_to "Staff", "#staff" %></li>
      <li><%= link_to "Interest", "#interest" %></li>
      <li><%= link_to "Eligibility", "#eligibility" %></li>
      <li><%= link_to "Characteristics", "#characteristics" %></li>
      <li><%= link_to "EHR Assessment", "#assessment" %></li><br />
      <li><%= link_to "Back", :back %></li>
      <li><%= f.submit "Save!" %></li>
    </ul>
  </nav>
</div>

<div id='nav-right'>
  <div class='box'>
    <a name="general"></a>
    <p class='title'>General</p>
    <table class='space'>
      <tr>
        <td><%= f.label :name, "Name" %></td>
        <td><%= f.text_field :name, size: 40 %></td>
      </tr>
      <tr>
        <td><%= f.label :partner_id, "Primary Recruiter" %></td>
        <td><%= f.select :partner_id, options_for_select(policy_scope(Partner).order("name").map{ |p| [p.name, p.id] }, selected: @practice.partner_id || @partner_id) %></td>
      </tr>
      <tr>
        <td><%= f.label :recruitment_source, "Recruitment Source" %></td>
        <td><%= f.select :recruitment_source, Practice::RECRUITMENT_SOURCE_VALS, { include_blank: true }, { class: 'enable-control', data: { :effector => '#practice_recruitment_source_referral', :enablevalue => 4 } }  %></td>
      </tr>
      <tr class='disabled-question'>
        <td><%= f.label :recruitment_source_referral, "Specify" %></td>
        <td><%= f.text_field :recruitment_source_referral %></td>
      </tr>
      <tr>
        <td><%= f.label :address %></td>
        <td><%= f.text_field :address, size: 40 %></td>
      </tr>
      <tr>
        <td><%= f.label :phone %></td>
        <td><%= f.text_field :phone %></td>
      </tr>
      <tr>
        <td><%= f.label :url, "URL" %></td>
        <td><%= f.text_field :url, size: 40 %></td>
      </tr>
      <tr>
        <td><%= f.label :email, "Email" %></td>
        <td><%= f.text_field :email, size: 40 %></td>
      </tr>
      <tr>
        <td><%= f.label :npi, "NPI#" %></td>
        <td><%= f.text_field :npi, size: 40 %></td>
      </tr>
    </table>
  </div>

  <div class='box'>
    <a name='staff'></a>
    <p class='title'>Staff</p>
    <div id='personnels'>
      <%= f.fields_for :personnels do |personnel| %>
        <%= render 'personnel_fields', :f => personnel %>
      <% end %>
    </div>
    <div class='links'>
      <%= link_to_add_association 'Add Staff Member', f, :personnels %>
    </div>
  </div>

  <div class='box'>
    <a name="interest"></a>
    <p class='title'>Interest</p>
    <table class='space'>
      <tr>
        <td><%= f.label :interest_yn, "Are you interested in participating in this study?" %></td>
        <td><%= f.select :interest_yn, Practice::YN12_VALS, { include_blank: true }, { class: 'enable-control', data: { :effector => '#practice_interest_why_not', :enablevalue => 2 } } %></td>
      </tr>
      <tr class='disabled-question'>
        <td><%= f.label :interest_why_not, "If no, why not?" %></td>
        <td><%= f.select :interest_why_not, Practice::INTEREST_WHY_NOT_VALS, { include_blank: true }, { class: 'enable-control', data: { :effector => '#practice_interest_why_not_other', :enablevalue => 99 } } %></td>
      </tr>
      <tr class='disabled-question'>
        <td><%= f.label :interest_why_not_other, "Please specify:" %></td>
        <td><%= f.text_field :interest_why_not_other %></td>
      </tr>
      <tr>
        <td><%= f.label :interest_why, "Why is your practice interested in participating in H2N?" %></td>
        <td><%= f.text_area :interest_why, rows: 3, cols: 50 %></td>
      </tr>
      <tr>
        <td><%= f.label :interest_expect, "What are your practice's expected outcomes from participating in H2N? What do you hope your practice gets out of participating?" %></td>
        <td><%= f.text_area :interest_expect, rows: 3, cols: 50 %></td>
      </tr>
      <tr>
        <td><%= f.label :interest_challenge, "What do you expect your practice's challenges will be?" %></td>
        <td><%= f.text_area :interest_challenge, rows: 3, cols: 50 %></td>
      </tr>
    </table>
  </div>

  <div class='box'>
    <a name="eligibility"></a>
    <p class='title'>Eligibility</p>
    <table class='space'>
      <tr>
        <td><%= f.label :primary_care, "1. Primary care practice with Family Physicians or General Internists" %></td>
        <td><%= f.select :primary_care, Practice::YN12_VALS, include_blank: true %></td>
      </tr>
      <tr>
        <td><%= f.label :elig_phys_count, "2. Number of MDs at street address of practice" %></td>
        <td><%= f.text_field :elig_phys_count, size: 5 %></td>
      </tr>
      <tr>
        <td><%= f.label :elig_phys_fte, "3. Number of combined MD FTE at street address of practice" %></td>
        <td><%= f.text_field :elig_phys_fte, size: 5 %></td>
      </tr>
      <tr>
        <td><%= f.label :prac_ehr, "4. Does your practice use an electronic health record (EHR) system? Do not include billing record systems." %></td>
        <td><%= f.select :prac_ehr, Practice::PRAC_EHR_VALS, include_blank: true %></td>
      </tr>
      <tr>
        <td><%= f.label :prac_ehr_mu, "5. Is your current system Certified to meet Meaningful Use as defined by Health and Human Services/ONC?" %></td>
        <td><%= f.select :prac_ehr_mu, Practice::YN12_VALS, include_blank: true %></td>
      </tr>
      <tr>
        <td><%= f.label :prac_ehr_mu_yr, "6. What year was your EHR certified?" %></td>
        <td><%= f.text_field :prac_ehr_mu_yr, size: 4 %></td>
      </tr>
    </table>
  </div>

  <div class='box'>
    <a name='characteristics'></a>
    <p class='title'>Practice Characteristics</p>
    <table class='space'>
      <tr>
        <td><%= f.label :elig_ownership, "1. Which of the following describes your practice's ownership? (Choose one)" %></td>
        <td><%= f.select :elig_ownership, Practice::ELIG_OWNERSHIP_VALS, { include_blank: true }, { class: 'enable-control', data: { :effector => '#practice_elig_ownership_other', :enablevalue => 99 } }   %></td>
      </tr>
      <tr class='disabled-question'>
        <td><%= f.label :elig_ownership_other, "Specify" %></td>
        <td><%= f.text_field :elig_ownership_other  %></td>
      </tr>
      <tr>
        <td><%= f.label :elig_ownership_years, "2. How many years has this practice been under the current ownership? (Please round to the nearest year and enter 0 if this year has been under the current ownership for less than one year)" %></td>
        <td><%= f.text_field :elig_ownership_years, size: 5  %></td>
      </tr>
      <tr>
        <td><%= f.label :elig_clinic_count, "3. What is the total number of primary care clinics operated by parent organization?" %></td>
        <td><%= f.text_field :elig_clinic_count, size: 5  %></td>
      </tr>
      <tr>
        <td><%= f.label :elig_specialty, "4. Which of the following describes your practice's specialty mix?" %></td>
        <td><%= f.select :elig_specialty, Practice::ELIG_SPECIALTY_VALS, include_blank: true  %></td>
      </tr>
      <tr>
        <td><%= f.label :elig_pcmh, "5. Is your practice PCMH recognized or accredited?" %></td>
        <td><%= f.select :elig_pcmh, Practice::YN12_VALS, include_blank: true  %></td>
      </tr>
      <tr>
        <td><%= f.label :elig_aco, "6. Is your practice part of an accountable care organization (ACO)?" %></td>
        <td><%= f.select :elig_aco, Practice::ELIG_ACO_VALS, include_blank: true  %></td>
      </tr>
      <tr>
        <td><%= f.label :elig_aco_apply, "7. Is your practice part of an organization applying to be an ACO?" %></td>
        <td><%= f.select :elig_aco_apply, Practice::YN12_VALS, include_blank: true  %></td>
      </tr>
    </table>
  </div>

  <div class='box'>
    <a name='assessment'></a>
    <p class='title'>EHR Assessment</p>
    <table class='space'>
      <tr>
        <td><%= f.label :prac_ehr_yr, "1. In which year did you install your current EHR system?" %></td>
        <td><%= f.text_field :prac_ehr_yr, size: 5 %></td>
      </tr>
      <tr>
        <td><%= f.label :prac_ehrname, "2. What is the name of your current EHR system? (choose one)" %></td>
        <td>
          <%= f.select :prac_ehrname, Practice::PRAC_EHRNAME_VALS, { include_blank: true }, { class: 'enable-control', data: { :effector => '#practice_prac_ehrname_other', :enablevalue => 99 } }   %>
        </td>
      </tr>
      <tr class='disabled-question'>
        <td><%= f.label :prac_ehrname_other, "Please specify" %></td>
        <td><%= f.text_field :prac_ehrname_other %></td>
      </tr>
      <tr>
        <td><%= f.label :prac_ehrversion, "3. What version of your EHR system are you currently using?" %></td>
        <td><%= f.text_field :prac_ehrversion %></td>
      </tr>
      <tr>
        <td><%= f.label :prac_mu_stage1, '4. Medicare and Medicaid offer incentives to practices that demonstrate "meaninful use of health IT." At your practice, are there plans to apply for Stage 1 of these incentive payments?' %></td>
        <td>
          <%= f.select :prac_mu_stage1, Practice::PRAC_MU_STAGE1_VALS, include_blank: true  %>
        </td>
      </tr>
      <tr>
        <td><%= f.label :prac_mu_stage2, "5. Are there plans to apply for Stage 2 incentive payments?" %></td>
        <td>
          <%= f.select :prac_mu_stage2, Practice::YNM123_VALS, include_blank: true  %>
        </td>
      </tr>
      <tr>
        <td><%= f.label :prac_ehr_extractdata, "6. Does your practice have someone who is able to extract data from the EHR for purposes of quality reporting?" %></td>
        <td>
          <%= f.select :prac_ehr_extractdata, Practice::YN12_VALS, include_blank: true  %>
        </td>
      </tr>
      <tr>
        <td><%= f.label :prac_ehr_person_extractdata, "7. Who is the person responsible for extracting data from the EHR for purposes of quality reporting?" %></td>
        <td>
          <%= f.select :prac_ehr_person_extractdata, Practice::PRAC_EHR_PERSON_EXTRACTDATA_VALS, { include_blank: true }, { class: 'enable-control', data: { :effector => '#practice_prac_ehr_person_extractdata_other', :enablevalue => 9 } }   %>
        </td>
      </tr>
      <tr class='disabled-question'>
        <td><%= f.label :prac_ehr_person_extractdata_other, "Please specify" %></td>
        <td><%= f.text_field :prac_ehr_person_extractdata_other %></td>
      </tr>
      <tr>
        <td> 8. What is the name and contact information of the person responsible for extracting data from the EHR for quality reporting?</td>
        <td>(Please enter this information in the Staff List)</td>
      </tr>
      <tr>
        <td><%= f.label :prac_it_support, "9. Does your practice have a Health IT support person who can help with EHR problems when they arise?" %></td>
        <td><%= f.select :prac_it_support, Practice::YN12_VALS, include_blank: true  %></td>
      </tr>
      <tr class='toggle-enable'>
        <td>10. What is the name and contact information of the support person responsible for helping with EHR problems?</td>
        <td>(Please enter this information in the Staff List)</td>
      </tr>
      <tr>
        <td><%= f.label :prac_ehr_vendor, "11. If your EHR vendor helps extract data and CQMs, are there restriction (e.g., a contract saying they own data) that prevent you from sharing or adapting?" %></td>
        <td><%= f.select :prac_ehr_vendor, Practice::YN12_VALS, include_blank: true  %></td>
      </tr>
      <tr>
        <td><%= f.label :prac_share_healthinfo, "12. Do you share any patient health information (e.g., lab results, imaging reports, problem lists, medication lists) electronically (not with fax) with any other providers, including hospitals, ambulatory providers or labs?" %></td>
        <td><%= f.select :prac_share_healthinfo, Practice::YN12_VALS, include_blank: true  %></td>
      </tr>
      <tr>
        <td><%= f.label :prac_cqm, "13. Is your practice able to generate clinical quality measures (CQM) from the EHR?" %></td>
        <td><%= f.select :prac_cqm, Practice::YN12_VALS, include_blank: true  %></td>
      </tr>
      <tr>
        <td>14. Who generates CQM reports in your practice?</td>
        <td>(Please enter this information in the Staff List)</td>
      </tr>
      <tr>
        <td><%= f.label :prac_cqm_submit, "15. Have you or are you soon going to submit CQM reports through the Physician Quality Reporting System (PQRS)?" %></td>
        <td><%= f.select :prac_cqm_submit, Practice::YN12_VALS, include_blank: true  %></td>
      </tr>
      <tr>
        <td><%= f.label :prac_cqm_who, "16. Through whom do you or will you report? (Examples include CMS, professional societies, state organizations" %></td>
        <td><%= f.text_area :prac_cqm_who, :cols => 30, :rows => 3, :limit => 200 %></td>
      </tr>
      <tr>
        <td><%= f.label :prac_ehr_satisfaction, "17. Overall, how satisfied or dissatisfied are you with your EHR system?" %></td>
        <td><%= f.select :prac_ehr_satisfaction, Practice::SATISFIED1234_VALS, include_blank: true  %></td>
      </tr>
      <tr>
        <td><%= f.label :prac_new_ehr, "18. At your practice are there plans for installing a new EHR system within the next 18 months?" %></td>
        <td><%= f.select :prac_new_ehr, Practice::YNMU1234_VALS, include_blank: true  %></td>
      </tr>
    </table>
  </div>
<% end %>
</div>